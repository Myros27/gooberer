<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <p id="playerId"></p>

    <button onclick="deleteAllSaves()">Delete All Saves</button>
    <button onclick="saveData('player123', 'ident123', 'Chrome Browser', new Date().toISOString(), { score: 100 })">Save Data Player 123</button>
    <button onclick="saveData('player456', 'ident456', 'Firefox Browser', new Date().toISOString(), { score: 200 })">Save Data Player 456</button>
    <button onclick="saveData('player789', null, 'Safari Browser', new Date().toISOString(), { score: 300 })">Save Data Player 789</button>
    <button onclick="fetchSaves('player123')">Fetch Saves for Player 123</button>
    <button onclick="fetchSaves('player456')">Fetch Saves for Player 456</button>
    <button onclick="fetchSaves('player789')">Fetch Saves for Player 789</button>
    <button onclick="fetchAllIdents()">Fetch All Idents</button>
    <button onclick="fetchAllPlayerIds()">Fetch All Player IDs</button>
    
    <div id="result"></div>
</body>
</html>

<script>
    var save;
    var settings;
    var parameters = {};
    
    window.addEventListener('message', function(event) {
        let receivedData = JSON.parse(atob(event.data));
        if (receivedData.action === 'jsException') {
            return;
        }
        save = receivedData.save;
        settings = receivedData.additionalInfo;
        feature();
    });

    function feature(){
        document.getElementById("playerId").innerText = save.playerId
    }

    //const apiUrl = 'https://cloudsavez-production.up.railway.app';
    const apiUrl = 'https://gooberer.glitch.me';

    async function deleteAllSaves() {
        try {
            const response = await fetch(`${apiUrl}/deleteAllSaves`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
            });

            const result = await response.json();
            document.getElementById('result').innerText = 'Delete All Saves Response: ' + JSON.stringify(result, null, 2);
        } catch (error) {
            console.error('Error deleting all saves:', error);
            document.getElementById('result').innerText = 'Error deleting all saves: ' + error;
        }
    }

    async function saveData(playerId, ident, deviceDescription, timeStamp, saveData) {
        try {
            const response = await fetch(`${apiUrl}/save`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ playerId, ident, deviceDescription, timeStamp, saveData }),
            });

            const result = await response.json();
            document.getElementById('result').innerText = 'Save Response: ' + JSON.stringify(result, null, 2);
        } catch (error) {
            console.error('Error saving data:', error);
            document.getElementById('result').innerText = 'Error saving data: ' + error;
        }
    }

    async function fetchSaves(playerId) {
        try {
            const response = await fetch(`${apiUrl}/getSavesByPlayerId/${playerId}`);
            const result = await response.json();
            document.getElementById('result').innerText = `Saves for Player ID ${playerId}: ` + JSON.stringify(result, null, 2);
        } catch (error) {
            console.error('Error fetching saves by playerId:', error);
            document.getElementById('result').innerText = 'Error fetching saves: ' + error;
        }
    }

    async function fetchAllPlayerIds() {
        try {
            const response = await fetch(`${apiUrl}/returnAllPlayerIdsFromFiles`);
            const result = await response.json();
            document.getElementById('result').innerText = 'All Player IDs: ' + JSON.stringify(result, null, 2);
        } catch (error) {
            console.error('Error fetching all player IDs:', error);
            document.getElementById('result').innerText = 'Error fetching all player IDs: ' + error;
        }
    }

    async function fetchAllIdents() {
        try {
            const response = await fetch(`${apiUrl}/returnAllIdents`);
            const result = await response.json();
            document.getElementById('result').innerText = 'All Idents: ' + JSON.stringify(result, null, 2);
        } catch (error) {
            console.error('Error fetching all idents:', error);
            document.getElementById('result').innerText = 'Error fetching all idents: ' + error;
        }
    }
    
</script>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    button {
        margin: 5px;
    }
    #result {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        background-color: #f9f9f9;
        white-space: pre-wrap;
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/5.4.55/css/materialdesignicons.min.css">
<link rel="stylesheet" href="https://myros27.github.io/gooberer/1.5/menu/menu.css">
